<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ウォレット認証</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
</head>
<body>
    <h2>Metamaskでウォレット認証</h2>
    <button id="signButton">署名する</button>
    <p id="result"></p>

    <script>
        window.onload = function () {
            document.getElementById("signButton").addEventListener("click", signMessage);
        };

        async function signMessage() {
            console.log("📌 signMessage() が実行されました");

            if (!window.ethereum) {
                alert("Metamaskをインストールしてください！");
                console.log("❌ Metamaskが見つかりません");
                return;
            }

            try {
                // Metamask接続
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                console.log("✅ Metamaskの接続に成功");

                const signer = provider.getSigner();
                const address = await signer.getAddress();
                console.log("✅ ウォレットアドレス:", address);

                // output.txt を読み込んでチェック
                const isInList = await checkWalletInList(address);
                if (isInList) {
                    document.getElementById("result").textContent = "✅ 該当！";
                    console.log("✅ ウォレットリストに含まれています");
                } else {
                    document.getElementById("result").textContent = "❌ 該当なし";
                    console.log("❌ ウォレットリストに含まれていません");
                }
            } catch (error) {
                console.error("❌ 認証エラー:", error);
                alert("認証に失敗しました。");
            }
        }

       // ウォレットリストを直接埋め込む
const walletList = [
    "0x0000...dEaD", "0x255E...2D24", "0x571F...250d", "0xD14c...3c67",
    "0xc717...971C", "0x29C7...e086", "0xff11...11Cf", "0xEd9C...DCDE",
    "0xd287...2D84", "0xCeD4...1902", "0x9694...C7B4", "0x961B...018C",
    "0x909C...2cfD", "0x7489...BB9D", "0x6DE8...7960", "0x35Ce...6762",
    "0x124E...3FA7", "0xff70...917e", "0xFE29...6eD7", "0xb716...8E51"
    // 必要に応じて続ける...
];

async function checkWalletInList(userAddress) {
    const formattedUserAddress = userAddress.slice(0, 6) + "..." + userAddress.slice(-4);
    console.log("🔍 確認中のウォレット:", formattedUserAddress);
    console.log("📜 ウォレットリスト:", walletList);
    return walletList.includes(formattedUserAddress);
}


    </script>
</body>
</html>
